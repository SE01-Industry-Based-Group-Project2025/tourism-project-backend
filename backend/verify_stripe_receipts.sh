#!/usr/bin/env bash

# Stripe Receipt Email Verification Script
echo "üîç STRIPE RECEIPT EMAIL VERIFICATION"
echo "===================================="

echo ""
echo "üìã CHECKLIST FOR STRIPE RECEIPT EMAILS:"
echo ""

echo "1. ‚úÖ Backend Configuration:"
echo "   - setCustomerEmail() ‚úÖ"
echo "   - setReceiptEmail() in PaymentIntentData ‚úÖ"
echo "   - Enhanced logging ‚úÖ"
echo ""

echo "2. ‚ö†Ô∏è  IMPORTANT: Stripe Test Mode Limitations"
echo "   - Stripe does NOT send actual emails in TEST MODE"
echo "   - Emails are simulated but not delivered"
echo "   - Check Stripe Dashboard instead"
echo ""

echo "3. üîç How to Verify Receipt Email Setup:"
echo ""
echo "   Method A: Check Stripe Dashboard"
echo "   ================================"
echo "   1. Go to: https://dashboard.stripe.com/test/payments"
echo "   2. Create a test booking in your app"
echo "   3. Find the PaymentIntent in Stripe Dashboard"
echo "   4. Check if 'receipt_email' field is populated"
echo ""

echo "   Method B: Check Application Logs"
echo "   ================================"
echo "   1. Watch backend logs during booking creation"
echo "   2. Look for: 'Setting receipt email to: [email]'"
echo "   3. Look for: 'Customer Email: [email]' in session creation"
echo ""

echo "   Method C: Use Stripe CLI (Advanced)"
echo "   ==================================="
echo "   1. Install Stripe CLI: https://stripe.com/docs/stripe-cli"
echo "   2. Login: stripe login"
echo "   3. Listen to events: stripe listen --events payment_intent.succeeded"
echo "   4. Check event data for receipt_email field"
echo ""

echo "4. üö® FOR ACTUAL EMAIL DELIVERY:"
echo "   - Switch to Stripe LIVE MODE (not test mode)"
echo "   - Use real payment methods"
echo "   - Use real email addresses"
echo "   - ‚ö†Ô∏è  You will be charged real money!"
echo ""

echo "5. üõ†Ô∏è  TROUBLESHOOTING:"
echo ""
echo "   If receipt_email is NOT set in Stripe Dashboard:"
echo "   - Check backend logs for errors"
echo "   - Verify user email is not null/empty"
echo "   - Check Stripe API key configuration"
echo ""

echo "   If receipt_email IS set but no email received:"
echo "   - Confirm you're in TEST MODE (emails are simulated)"
echo "   - Check spam/junk folder (for live mode)"
echo "   - Verify email address format"
echo ""

echo "6. üìß TESTING RECEIPT EMAILS:"
echo ""
echo "   Step 1: Create a booking through your frontend"
echo "   Step 2: Complete the Stripe checkout"
echo "   Step 3: Check backend logs for receipt email setup"
echo "   Step 4: Verify in Stripe Dashboard"
echo ""

echo "   Backend should log:"
echo "   - 'Setting receipt email to: user@example.com'"
echo "   - 'Customer Email: user@example.com'"
echo "   - 'Payment Intent: pi_xxxxx'"
echo ""

echo "‚úÖ VERIFICATION COMPLETE"
echo "========================"
echo ""
echo "Next steps:"
echo "1. Start your backend server"
echo "2. Create a test booking"
echo "3. Check the logs and Stripe Dashboard"
echo "4. The setup is correct - emails are simulated in test mode"
